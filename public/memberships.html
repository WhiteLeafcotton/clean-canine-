<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Membership | Clean Canine Co.</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* Reset and base */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }
    body {
      font-family: 'DM Sans', sans-serif;
      background: #fff;
      color: #111;
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    /* Header */
    header {
      background-color: #000;
      color: #fff;
      padding: 0.6rem 2%;
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 3.5rem;
      display: flex;
      align-items: center;
      z-index: 1000;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 1.4rem;
      letter-spacing: 1.5px;
    }
    header a.brand-name {
      color: #fff;
      text-decoration: none;
    }

    main {
      padding: 5rem 2rem 3rem;
      max-width: 600px;
      margin: 0 auto;
      flex-grow: 1;
    }

    h1 {
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 1.4rem;
      color: #111;
      text-align: center;
    }

    /* Form container and sliding cards */
    .form-container {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.8rem 1.6rem 2.2rem;
      box-shadow: 0 6px 15px rgba(0,0,0,0.07);
      background: #f9faff;
      position: relative;
      overflow: hidden;
    }

    .slides {
      display: flex;
      transition: transform 0.4s ease-in-out;
      width: 300%; /* 3 slides */
    }

    .slide {
      flex: 1 0 100%;
      padding: 0 0.5rem;
    }

    /* Form fields styling */
    label {
      display: block;
      margin-bottom: 0.35rem;
      font-weight: 600;
      color: #222;
    }

    input, select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      margin-bottom: 1.2rem;
      border: 1.6px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #6ea7ff;
      box-shadow: 0 0 5px #a0c0ff99;
    }

    /* Buttons */
    .button-row {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      gap: 0.8rem;
    }

    button {
      cursor: pointer;
      background-color: #000;
      color: #fff;
      border: none;
      padding: 0.7rem 1.4rem;
      border-radius: 6px;
      font-weight: 700;
      font-size: 1rem;
      flex-grow: 1;
      transition: background-color 0.3s;
    }

    button:hover:not(:disabled) {
      background-color: #3a64ff;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    /* Add pet button */
    .add-pet-btn {
      background-color: #3a64ff;
      margin-bottom: 1rem;
      width: 100%;
      font-weight: 600;
    }
    .add-pet-btn:hover {
      background-color: #274dcb;
    }

    /* Pet card */
    .pet-card {
      background: white;
      border: 1px solid #bbb;
      border-radius: 6px;
      padding: 1rem 1.2rem;
      margin-bottom: 1.2rem;
      position: relative;
      box-shadow: 0 3px 6px rgb(0 0 0 / 0.08);
    }
    .pet-card h3 {
      margin-bottom: 0.6rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: #333;
    }
    .remove-pet-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.3rem;
      color: #ff3b3b;
      cursor: pointer;
      font-weight: 700;
      line-height: 1;
      padding: 0;
    }
    .remove-pet-btn:hover {
      color: #d12c2c;
    }

    /* Error message */
    .error-msg {
      color: #d12c2c;
      font-weight: 700;
      margin-bottom: 1rem;
      text-align: center;
    }

    /* Success message */
    .success-msg {
      color: #2a8f2a;
      font-weight: 700;
      margin: 1rem 0;
      text-align: center;
    }

    /* Step indicators */
    .step-indicators {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
      gap: 10px;
    }
    .step-indicators div {
      width: 12px;
      height: 12px;
      background: #ccc;
      border-radius: 50%;
      transition: background-color 0.3s;
    }
    .step-indicators div.active {
      background: #000;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 1.5rem 1rem;
      font-size: 0.9rem;
      color: #555;
      background-color: #f8f8f8;
      border-top: 1px solid #eaeaea;
      margin-top: auto;
    }

    /* Responsive */
    @media (max-width: 480px) {
      main {
        padding: 5rem 1rem 3rem;
      }
      button {
        font-size: 0.9rem;
        padding: 0.6rem 1rem;
      }
    }
  </style>
</head>
<body>

  <header>
    <a href="index.html" class="brand-name">clean canine Co.</a>
  </header>

  <main>
    <h1>Become a Clean Canine Member</h1>

    <div class="form-container" aria-label="Membership sign up form">

      <div class="step-indicators" aria-hidden="true">
        <div class="step-dot active"></div>
        <div class="step-dot"></div>
        <div class="step-dot"></div>
      </div>

      <form id="membership-form">

        <div class="slides" id="slides">
          <!-- Step 1: Personal Info -->
          <section class="slide" aria-label="Personal Information">
            <label for="fullName">Full Name *</label>
            <input type="text" id="fullName" name="fullName" required autocomplete="name" placeholder="Your full name" />

            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required autocomplete="email" placeholder="you@example.com" />

            <label for="phone">Phone Number *</label>
            <input type="tel" id="phone" name="phone" required autocomplete="tel" placeholder="(555) 123-4567" pattern="[\d\s()+-]{7,15}" />
          </section>

          <!-- Step 2: Pets Info -->
          <section class="slide" aria-label="Pet Information">
            <div id="pets-container">
              <!-- Dynamic pets go here -->
            </div>
            <button type="button" class="add-pet-btn" id="addPetBtn" aria-label="Add another pet">+ Add Another Pet</button>
          </section>

          <!-- Step 3: Address & Submit -->
          <section class="slide" aria-label="Address and Membership Payment">
            <label for="address">Home Address *</label>
            <input type="text" id="address" name="address" required placeholder="123 Main St" autocomplete="street-address" />

            <label for="city">City *</label>
            <input type="text" id="city" name="city" required placeholder="Milwaukee" autocomplete="address-level2" />

            <label for="state">State *</label>
            <select id="state" name="state" required autocomplete="address-level1" aria-required="true">
              <option value="">Select State</option>
              <option value="WI" selected>Wisconsin</option>
              <option value="IL">Illinois</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="IA">Iowa</option>
              <option value="IN">Indiana</option>
            </select>

            <label for="zip">ZIP Code *</label>
            <input type="text" id="zip" name="zip" required placeholder="53202" pattern="\d{5}" maxlength="5" autocomplete="postal-code" />

            <div id="area-error" class="error-msg" role="alert" style="display:none;">Sorry, area not covered. We only service within 40 miles of Milwaukee, WI.</div>

            <button type="submit" id="submitBtn" style="margin-top:1.4rem;">Pay $35 / month per pet</button>

            <div id="form-success" class="success-msg" role="alert" style="display:none;">
              Thank you! Redirecting to payment...
            </div>
          </section>
        </div>

        <div class="button-row">
          <button type="button" id="prevBtn" disabled aria-label="Previous step">← Previous</button>
          <button type="button" id="nextBtn" aria-label="Next step">Next →</button>
        </div>
      </form>
    </div>
  </main>

  <footer>
    <form style="display: flex; flex-direction: column; max-width: 320px; margin: 0 auto 1rem;" action="https://formspree.io/f/mayvlwnk" method="POST" target="_blank">
      <label for="subscribe-email" style="font-weight: 600; font-size: 0.9rem; color: #333;">Subscribe to our newsletter</label>
      <input type="email" id="subscribe-email" name="email" placeholder="Your email" required
             style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.8rem; margin-bottom: 0.5rem;" />
      <button type="submit" style="padding: 0.45rem; background-color: #111; color: #fff; border: none; border-radius: 4px; font-size: 0.78rem; cursor: pointer;">Join</button>
    </form>
    <div style="font-size: 0.65rem; color: #999;">
      &copy; 2025 Clean Canine Co. All rights reserved.
    </div>
  </footer>

<script>
  // Variables
  const slides = document.getElementById('slides');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const form = document.getElementById('membership-form');
  const stepIndicators = document.querySelectorAll('.step-indicators div');
  const petsContainer = document.getElementById('pets-container');
  const addPetBtn = document.getElementById('addPetBtn');
  const areaError = document.getElementById('area-error');
  const submitBtn = document.getElementById('submitBtn');
  const formSuccess = document.getElementById('form-success');

  // Milwaukee ZIP codes (within ~40 miles radius)
  // For simplicity just checking these zip codes only, you can expand the list
  // Source: approximate coverage; add more if you want later
  const allowedZipCodes = new Set([
    '53202','53203','53204','53205','53206','53207','53208','53209','53210','53211',
    '53212','53213','53214','53215','53216','53217','53218','53219','53220','53221',
    '53222','53223','53224','53225','53226','53227','53228','53233','53172','53154',
    '53189','53188','53177','53110','53144','53158','53186','53132','53153','53129',
    '53130','53154','53195','53151','53235'
  ]);

  // Track form step
  let currentStep = 0;

  // Pet counter for unique IDs
  let petCount = 0;

  // Initialize with one pet form
  addPet();

  function updateStepUI() {
    slides.style.transform = `translateX(-${currentStep * 100}%)`;
    prevBtn.disabled = currentStep === 0;
    nextBtn.style.display = currentStep === 2 ? 'none' : 'inline-block';

    stepIndicators.forEach((dot, i) => {
      dot.classList.toggle('active', i === currentStep);
    });

    // Submit button only visible on last step
    submitBtn.style.display = currentStep === 2 ? 'block' : 'none';

    // Scroll top for accessibility
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  prevBtn.addEventListener('click', () => {
    if (currentStep > 0) {
      currentStep--;
      updateStepUI();
    }
  });

  nextBtn.addEventListener('click', () => {
    if (validateStep(currentStep)) {
      currentStep++;
      updateStepUI();
    }
  });

  function validateStep(step) {
    let valid = true;
    if (step === 0) {
      // Personal info
      ['fullName', 'email', 'phone'].forEach(id => {
        const el = document.getElementById(id);
        if (!el.checkValidity()) {
          el.reportValidity();
          valid = false;
        }
      });
    } else if (step === 1) {
      // At least one pet and all pet fields valid
      if (petCount === 0) {
        alert('Please add at least one pet.');
        valid = false;
      }
      // Validate all pet inputs
      for (let i=0; i<petCount; i++) {
        const petName = document.getElementById(`petName-${i}`);
        const petType = document.getElementById(`petType-${i}`);
        const petAge = document.getElementById(`petAge-${i}`);

        if (!petName || !petType || !petAge) {
          valid = false;
          break;
        }

        if (!petName.checkValidity()) {
          petName.reportValidity();
          valid = false;
          break;
        }
        if (!petType.checkValidity()) {
          petType.reportValidity();
          valid = false;
          break;
        }
        if (!petAge.checkValidity()) {
          petAge.reportValidity();
          valid = false;
          break;
        }
      }
    } else if (step === 2) {
      // Address validation + ZIP code radius check
      ['address', 'city', 'state', 'zip'].forEach(id => {
        const el = document.getElementById(id);
        if (!el.checkValidity()) {
          el.reportValidity();
          valid = false;
        }
      });

      // Check ZIP code in allowed area
      const zip = document.getElementById('zip').value.trim();
      if (!allowedZipCodes.has(zip)) {
        areaError.style.display = 'block';
        valid = false;
      } else {
        areaError.style.display = 'none';
      }
    }
    return valid;
  }

  // Add a new pet form card
  function addPet() {
    const petIndex = petCount;
    petCount++;

    const petCard = document.createElement('div');
    petCard.className = 'pet-card';
    petCard.id = `petCard-${petIndex}`;
    petCard.innerHTML = `
      <h3>Pet #${petIndex + 1}</h3>
      <label for="petName-${petIndex}">Pet Name *</label>
      <input type="text" id="petName-${petIndex}" name="petName-${petIndex}" required placeholder="Your pet's name" />

      <label for="petType-${petIndex}">Pet Type *</label>
      <select id="petType-${petIndex}" name="petType-${petIndex}" required>
        <option value="" disabled selected>Select Type</option>
        <option>Dog</option>
        <option>Cat</option>
        <option>Other</option>
      </select>

      <label for="petAge-${petIndex}">Pet Age (years) *</label>
      <input type="number" id="petAge-${petIndex}" name="petAge-${petIndex}" min="0" max="50" required placeholder="e.g. 3" />

      <button type="button" class="remove-pet-btn" aria-label="Remove this pet" title="Remove this pet">&times;</button>
    `;

    petsContainer.appendChild(petCard);

    // Remove pet button handler
    petCard.querySelector('.remove-pet-btn').addEventListener('click', () => {
      petsContainer.removeChild(petCard);
      petCount--;
      // Re-label pet cards
      [...petsContainer.children].forEach((card, i) => {
        card.querySelector('h3').textContent = `Pet #${i + 1}`;
      });
    });
  }

  addPetBtn.addEventListener('click', addPet);

  // Handle form submission
  form.addEventListener('submit', async e => {
    e.preventDefault();

    // Validate last step before submit
    if (!validateStep(2)) {
      return;
    }

    // Collect all form data
    const formData = {
      fullName: form.fullName.value.trim(),
      email: form.email.value.trim(),
      phone: form.phone.value.trim(),
      pets: [],
      address: form.address.value.trim(),
      city: form.city.value.trim(),
      state: form.state.value,
      zip: form.zip.value.trim()
    };

    // Gather pets data
    for (let i = 0; i < petsContainer.children.length; i++) {
      const petCard = petsContainer.children[i];
      formData.pets.push({
        name: petCard.querySelector(`#petName-${i}`).value.trim(),
        type: petCard.querySelector(`#petType-${i}`).value,
        age: petCard.querySelector(`#petAge-${i}`).value.trim(),
      });
    }

    // Send form data to your email using Formspree
    try {
      await fetch('https://formspree.io/f/mayvlwnk', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fullName: formData.fullName,
          email: formData.email,
          phone: formData.phone,
          address: `${formData.address}, ${formData.city}, ${formData.state} ${formData.zip}`,
          pets: formData.pets.map(p => `${p.name} (${p.type}, Age: ${p.age})`).join('; '),
        }),
      });
    } catch (err) {
      alert('Sorry, there was a problem sending your info. Please try again.');
      return;
    }

    // Show success message and disable submit
    submitBtn.disabled = true;
    formSuccess.style.display = 'block';

    // Start Stripe subscription checkout
    const stripe = Stripe('pk_test_51RcTWABDLsp0C0Gfv3QRn7VDS8OQzZVZogq9zYZv5v9N2P2xT5kG0JUQMYxYh9k9xpZXU6WPRzVYZP3oOUOiL99ko00nhlI8TVp');

    try {
      const response = await fetch('/create-subscription-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quantity: formData.pets.length }),
      });
      const session = await response.json();

      if (session.error) {
        alert('Error creating payment session: ' + session.error);
        submitBtn.disabled = false;
        formSuccess.style.display = 'none';
        return;
      }

      // Redirect to Stripe Checkout
      const { error } = await stripe.redirectToCheckout({ sessionId: session.id });
      if (error) {
        alert(error.message);
        submitBtn.disabled = false;
        formSuccess.style.display = 'none';
      }
    } catch (err) {
      alert('There was an error initiating payment. Please try again.');
      submitBtn.disabled = false;
      formSuccess.style.display = 'none';
    }
  });

  // Initialize UI
  updateStepUI();
</script>

</body>
</html>


